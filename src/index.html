<html>

<head>

<script src="/socket.io/socket.io.js"></script>
<script>

	// 多分おまじない的なやつ
	const socket = io();

	// メッセージを一覧に追加する
	const addMessageList = (message) => {
		const ul = document.getElementById('messageList');
		const li = document.createElement('li');
		const text = document.createTextNode(message);
		li.appendChild(text);
		ul.appendChild(li);
	};
	
	// ウィンドウの読み込みが終わったときに実行される
	window.onload = function() {
	
		//送信ボタンがクリックされた場合のイベントを設定しておく
		document.getElementById('sendButton').addEventListener('click', () => {

			// テキストボックスに入力された文字列を取得
			let inputMessage = document.getElementById('inputText').value;

			// テキストボックスが空なら中止
			if (inputMessage === '') {
				return;
			}

			// メッセージ送信用のソケット通信を投げる
			socket.emit('sendMessage', inputMessage);
			
			// テキストボックスの中身をクリア
			document.getElementById('inputText').value = '';
		});
		
		// ソケットIDの割り当てをサーバーに要求する
		socket.emit('requestId', "");
	}

	// 'responseId' イベントの発火を検知し、IDを表示する
	socket.on('responseId', (message) => {
		addMessageList("サーバーへの接続成功。あなたのidは次の通りです。 : " + message);
	});
	
	// 'receiveMessage' イベントの発火を検知し、サーバ側から引数で渡されたメッセージを一覧に追加する
	socket.on('receiveMessage', (message) => {
		addMessageList(message);
	});

</script>

</head>

<body>

<h1>simple chat</h1>
<input id="inputText" type="text">
<input id="sendButton" type="submit">
<ul id="messageList" />

</body>
</html>
